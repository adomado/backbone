<!DOCTYPE html> 
<html> 
 
  <head>
    <script>
      function initApiManager() {
        appApi = new ApiManager(ApiUtil.getQueryStringParam("uuid_pvt"), ApiUtil.getQueryStringParam("app_id"), {isDev : true, $ : $});
      }
    </script>

    <title>Facebook Feed</title> 
  	<link rel="stylesheet" href="/public/css/jquery-mobile/jquery.mobile-1.0a4.1.min.css" />
  	<link rel="stylesheet" href="/public/css/css.css" />
    <script src="http://localhost:3000/javascripts/app_api_jquery_packaged.js" onload="initApiManager()"></script>
    <script src="/public/js/backbone/json2.js"></script>
    <script src="/public/js/backbone/underscore-1.1.3.js"></script>
    <script src="/public/js/backbone/backbone.js"></script>
    <script src="/public/js/backbone/backbone-localstorage.js"></script>
    <script src="/lib/fb_storage.js"></script> 
    <script src="/lib/fb_auth.js"></script> 
    <script src="/lib/fb_feed.js?cb=1"></script> 
    <script src="/lib/fb_action.js"></script>
    <script src="/lib/fb_notification_watcher.js"></script>
    <script src="/lib/fb_me.js?cb=1"></script>
    <script src="/app/models/notification_item.js"></script>
    <script src="/app/models/feed_item.js?cb=11"></script>
    <script src="/app/collections/feed_list.js"></script>
    <script src="/app/collections/notification_list.js"></script>
    <script src="/app/views/feed.js?cb=21"></script>
    <script src="/app/views/item.js?cb=2"></script>
    <script src="/app/views/notifications.js"></script>
    <script src="/public/js/icanhaz/ICanHaz.min.js"></script>
    <script src="/public/js/autolink/jquery.autolink.js"></script>
  	<script src="/public/js/jquery-mobile/jquery.mobile-1.0a4.1.min.js"></script>

	  <script>
	    var FeedList, FeedApp, fbAuth, fbFeed, fbMe, appApi, CurrentFeedItem, NotificationList, Notifications, fbNotificationWatcher;
      fbAuth = new FBAuth("21577534106", document.location.href, function() { console.log("TODO - auth reinforce needed"); });

	    $(document).ready(function() {
        FeedList = new FeedListCollection;
        FeedApp = new FeedView(FeedList);
        NotificationList = new NotificationListCollection;
        Notifications = new NotificationView(NotificationList);
        fbNotificationWatcher = new FBNotificationWatcher(1);
      });
	  </script>
  	
  </head> 
 
  <body> 
  
    <!-- FB Feed Screen -->
    <div data-role="page" id="fb-feed-page" data-theme="b">
      <script id="fbFeedItem" type="text/html">
        <li class="ui-li-has-icon">
          <a class="fb-feed-item" href="#fb-feed-item-page" id={{itemId}} onclick="new ItemView('{{itemId}}');" data-rel="dialog" data-transition="slide">
            <img src="{{fromUserPic}}" class="ui-li-icon"/>
            <p style="padding-top:6px; padding-left: 20px;">
              <b>{{title}}</b><br/>
                <div style="float:left; margin-left:20px;">{{#picture}}<img style="max-height:32px;" src="{{picture}}"/>{{/picture}}</div>
                <div style="overflow:hidden; text-overflow:ellipsis; font-size:12px; font-weight:normal; margin-left:18px; {{#picture}}position:relative; left:5px;{{/picture}}">
                  {{description}}
                </div>
            </p>
            <p style="text-align:right;">
              <small>            
                <span id="{{itemId}}__item-likes-infeed" style="{{^likeCount}}display:none;{{/likeCount}}">
                  <span id="{{itemId}}__like-count-infeed">{{likeCount}}</span> <img class="like-comment-image" src="public/images/like_16.png"/> &nbsp; &nbsp;
                </span>
                <span id="{{itemId}}__item-comments-infeed" style="{{^commentCount}}display:none;{{/commentCount}}">
                  <span id="{{itemId}}__comment-count-infeed">{{commentCount}}</span> <img class="like-comment-image" src="public/images/comment.png"/> &nbsp; &nbsp;
                </span>   
                
                {{^likeCount}}
                  {{^commentCount}}
                    <br/>
                  {{/commentCount}}
                {{/likeCount}}
              </small>
            </p>
          </a>
        </li>
      </script>
        
	    <div data-role="header" data-theme="b">
		    <h1>Facebook Feed</h1>
		    <a href="#fb-feed-page" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-right jqm-home">Home</a> 
	    </div>

	    <div data-role="content" data-theme="b">	
	      <p style="text-align:center;" id="fb-loading-top">
	        <img src="public/images/spinner.gif" /><br/>Loading
	      </p>
		    <ul data-role="listview" id="fb-feed" style="display:none;">
        </ul>
	    </div>

	    <div data-role="footer" style="padding:5px 0px" data-theme="b">
        <div data-inline="true" style="text-align:center;">
	        <a href="#" data-role="button" data-inline="true" data-icon="arrow-d" id="more-feed">Show More</a> 
          <img src="public/images/spinner-small.gif" id="fb-loading-bottom" class="hidden">	        
        </div>	  
	    </div>
	    
      <script>
        $('#fb-feed-page').live('pagebeforecreate', function(event, ui) {
          if(fbAuth.needAuth() == true)
            $.mobile.changePage($("#fb-auth-page"));
        });
      </script>	  
    </div>
    <!-- FB Feed Screen -->
  
  
  
  
  
  
    
    <!-- FB Feed Item Screen -->
    <div data-role="page" id="fb-feed-item-page" data-theme="b">
      <script id="fbFeedItemDetail" type="text/html">
        <b>{{fromUserName}}</b>
        <table style="width:100%;">
          <tr>
            <td style="vertical-align: top; padding-top: 5px; width:50px;">
              <a href="{{fromUserProfile}}"><img width="50" src="{{fromUserPic}}"/></a>
            </td>
            <td style="vertical-align: top; padding-left:5px;">
              <span style="font-size:14px;">{{title}}</span>
              {{#linkTo}}<a target="_new" href="{{linkTo}}"><small>(Read more)</small></a>{{/linkTo}}
              <table>
                <tr>
                  {{#picture}}
                    <td style="vertical-align: top; padding-top: 5px;">
                      {{#linkTo}}<a target="_new" href="{{linkTo}}">{{/linkTo}}
                      <img style="max-width:100px;" src="{{picture}}"/><br/>
                      {{#linkTo}}</a>{{/linkTo}}                    
                    </td>
                  {{/picture}}
                  {{#description}}
                    <td style="vertical-align: top;">
                      <span style="font-size:12px;">{{description}}</span>
                    </td>
                  {{/description}}
                </tr>
              </table>
            </td>
          </tr>
          <tr style="margin-top:10px;">
            <td colspan="2">
              <div style="text-align:left; float:left;">
                <a href="{{permalink}}" target="_new"><small>See this on Facebook</small></a>
              </div>
              <div style="text-align:right; float:right;">
                <small>
                  <span id="item-likes" style="{{^likeCount}}display:none;{{/likeCount}}">
                    <span id="like-count">{{likeCount}}</span> <img class="like-comment-image" src="public/images/like_16.png"/> &nbsp; &nbsp;
                  </span>
                  <span id="item-comments" style="{{^commentCount}}display:none;{{/commentCount}}">
                    <span id="comment-count">{{commentCount}}</span> <img class="like-comment-image" src="public/images/comment.png"/> &nbsp; &nbsp;
                  </span>
                </small>
              </div>
            </td>
          </tr>
        </table>
      </script>
      
      <script id="fbFeedItemComment" type="text/html">
        <table>
          <tr>
            <td>
              <a href="{{userProfleLink}}" target="_new">
                <img style='padding-right:5px;' width='32' 
                  src='https://graph.facebook.com/{{commentFromUserId}}/picture?type=small'/>
              </a>
            </td>
            <td>
              <span class='comment-text'>{{commentText}}</span>
            </td>
          </tr>
        </table>
      </script>
    
	    <div data-role="header" data-theme="b">
		    <h1>Post Details</h1>
		    <a href="#fb-feed-page" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-right jqm-home">Home</a> 
	    </div>

	    <div data-role="content" data-theme="b">
        <!-- Item detail -->
	      <div id="fb-feed-item-detail"></div>

        <!-- Comments -->
	      <div data-role="collapsible" data-collapsed="true" id="fb-feed-item-comments" style="display:none;">
	        <h4>Comments</h4>
          <div style="text-align:center;" data-inline="true">
            <input type="text" name="fb-item-new-comment" id="fb-item-new-comment" value="" style="margin-bottom:5px;" />
            <small>
              <a id="fb-item-new-comment-button" href="javascript:void(0);" data-role="button" data-inline="true" data-icon="grid">Comment</a>
              <img src="public/images/spinner-small-black.gif" id="fb-comment-spinner" class="hidden">
            </small>
          </div>
	        <div id="comments"></div>
          <a href="#" style="display:none;" id="more-comments"><small>All comments<small></a>	      
	      </div>		  

        <!-- Like & back -->
        <div data-inline="true" style="text-align:right; float:right;">
          <img src="public/images/spinner-small-black.gif" id="fb-like-spinner" class="hidden">	  
          <img src="public/images/ok.png" id="fb-like-ok" class="hidden">
	        <a id="like-button" href="javascript:void(0);" data-role="button" data-inline="true" data-icon="star">Like</a>
        </div>
        <div data-inline="true" style="text-align:left; float:left;">
	        <a href="#fb-feed-page" data-role="button" data-inline="true" data-icon="arrow-l">Back</a>
        </div>
	    </div>
	    
	    <script>
        $('#fb-feed-item-page').live('pagebeforeshow', function(event, ui) {
          if(fbAuth.needAuth() == true)
            $("#auth-url").attr("href", fbAuth.getAuthUrl()).show();
        });
	    </script>
    </div>
    <!-- FB Feed Item Screen -->
  
  
  
  
  
  
  
  
    <!-- FB Auth Screen -->
    <div data-role="page" id="fb-auth-page" data-theme="b">
	    <div data-role="header">
		    <h1>Connect with Facebook</h1>
	    </div>

	    <div data-role="content" data-theme="b">	
	      <p style="text-align:center;">
	        <h3><a href="" id="auth-url">FB Connect</a></h3>
	      </p>
	    </div>
	    
	    <script>
        $('#fb-auth-page').live('pagebeforeshow', function(event, ui) {
          if(fbAuth.needAuth() == true)
            $("#auth-url").attr("href", fbAuth.getAuthUrl()).show();
          else
            $.mobile.changePage($("#fb-feed-page"));
        });
	    </script>
    </div>
    <!-- FB Auth Screen -->    
  
  
	  <div style="display:none;">
	    Feed List
		  <ul id="feed-items">
		  </ul>
	  </div>
	  
  </body> 
 
</html> 
