
<!DOCTYPE html> 
<html> 
 
  <head> 
    <title>Facebook Feed</title> 
  	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0a4/jquery.mobile-1.0a4.min.css" />
  	<link rel="stylesheet" href="./public/css/css.css" />
    <script language="javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js" type="text/javascript"></script>    
    <script src="http://documentcloud.github.com/backbone/test/vendor/json2.js"></script> 
    <script src="http://documentcloud.github.com/backbone/test/vendor/underscore-1.1.3.js"></script> 
    <script src="http://documentcloud.github.com/backbone/backbone.js"></script> 
    <script src="http://documentcloud.github.com/backbone/examples/backbone-localstorage.js"></script> 
    <script src="/lib/js.class/core.js"></script> 
    <script src="/lib/fb_storage.js"></script> 
    <script src="/lib/fb_auth.js"></script> 
    <script src="/lib/fb_feed.js"></script> 
    <script src="/lib/fb_action.js"></script> 
    <script src="/app/models/feed_item.js"></script> 
    <script src="/app/collections/feed_list.js"></script> 
    <script src="/app/views/feed.js"></script>
    <script src="/app/views/item.js"></script>
    <script language="javascript" src="/public/js/icanhaz/ICanHaz.min.js" type="text/javascript"></script>
    <script language="javascript" src="/public/js/autolink/jquery.autolink.js" type="text/javascript"></script>
  	<script type="text/javascript" src="http://code.jquery.com/mobile/1.0a4/jquery.mobile-1.0a4.min.js"></script>    

	  <script>
	    var FeedList, FeedApp, fbAuth, fbFeed, CurrentFeedItem;
      fbAuth = new FBAuth("21577534106", document.location.href, function() { console.log("TODO - auth reinforce needed"); });
      
	    $(document).ready(function() {
        FeedList = new FeedListCollection;	  
        FeedApp = new FeedView(FeedList);     	  
      });
	  </script>  	
  	
  </head> 
 
  <body> 
  
    <!-- FB Feed Screen -->
    <div data-role="page" id="fb-feed-page" data-theme="b">
      <script id="fbFeedItem" type="text/html">
        <li class="ui-li-has-icon">
          <a class="fb-feed-item" href="#fb-feed-item-page" id={{itemId}} onclick="new ItemView('{{itemId}}');" data-rel="dialog" data-transition="slide">
            <img src="{{fromUserPic}}" class="ui-li-icon"/>
            <p style="padding-top:6px; padding-left: 20px;">
              <b>{{title}}</b><br/>
              {{description}}
            </p>
            <p style="text-align:right;">
              <small>
                {{#likeCount}}
                  {{likeCount}} {{likeText}} &nbsp; &nbsp; 
                {{/likeCount}}
                {{#commentCount}}
                  {{commentCount}} {{commentText}} &nbsp; &nbsp; 
                {{/commentCount}}
                
                {{^likeCount}}
                  {{^commentCount}}
                    <br/>
                  {{/commentCount}}
                {{/likeCount}}
              </small>
            </p>
          </a>
        </li>
      </script>
        
	    <div data-role="header" data-theme="b">
		    <h1>Facebook Feed</h1>
		    <a href="#fb-feed-page" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-right jqm-home">Home</a> 
	    </div>

	    <div data-role="content" data-theme="b">	
	      <p style="text-align:center;" id="fb-loading-top">
	        <img src="public/images/spinner.gif" /><br/>Loading
	      </p>
		    <ul data-role="listview" id="fb-feed" style="display:none;">
        </ul>
	    </div>

	    <div data-role="footer" style="padding:5px 0px" data-theme="b">
        <div data-inline="true" style="text-align:center;">
	        <a href="#" data-role="button" data-inline="true" data-icon="arrow-d" 
	          onclick="$('#fb-loading-bottom').show(); fbFeed.getMore();">Show More</a>
          <img src="public/images/spinner-small.gif" id="fb-loading-bottom">	        
        </div>	  
	    </div>
	    
      <script>
        $('#fb-feed-page').live('pagebeforecreate', function(event, ui) {
          if(fbAuth.needAuth() == true)
            $.mobile.changePage($("#fb-auth-page"));
        });
      </script>	  
    </div>
    <!-- FB Feed Screen -->
  
  
  
  
  
  
    
    <!-- FB Feed Item Screen -->
    <div data-role="page" id="fb-feed-item-page" data-theme="b">
      <script id="fbFeedItemDetail" type="text/html">
        <b>{{fromUserName}}</b>
        <table style="width:100%;">
          <tr>
            <td style="vertical-align: top; padding-top: 5px; width:50px;">
              <a href="{{fromUserProfile}}"><img width="50" src="{{fromUserPic}}"/></a>
            </td>
            <td style="vertical-align: top; padding-left:5px;">
              <span style="font-size:14px;">{{title}}</span>
              {{#linkTo}}<a target="_new" href="{{linkTo}}"><small>(Read more)</small></a>{{/linkTo}}
              <table>
                <tr>
                  {{#picture}}
                    <td style="vertical-align: top; padding-top: 5px;">
                      {{#linkTo}}<a target="_new" href="{{linkTo}}">{{/linkTo}}
                      <img style="max-width:100px;" src="{{picture}}"/><br/>
                      {{#linkTo}}</a>{{/linkTo}}                    
                    </td>
                  {{/picture}}
                  {{#description}}
                    <td style="vertical-align: top;">
                      <span style="font-size:12px;">{{description}}</span>
                    </td>
                  {{/description}}
                </tr>
              </table>
            </td>
          </tr>
          <tr style="margin-top:10px;">
            <td colspan="2">
              <div style="text-align:left; float:left;">
                <a href="{{permalink}}" target="_new"><small>See this on Facebook</small></a>
              </div>
              <div style="text-align:right; float:right;">
                <small>
                  {{#likeCount}}
                    {{likeCount}} {{likeText}} &nbsp; &nbsp; 
                  {{/likeCount}}
                  {{#commentCount}}
                    {{commentCount}} {{commentText}} &nbsp; &nbsp; 
                  {{/commentCount}}            
                </small>
              </div>
            </td>
          </tr>
        </table>
      </script>
      
      <script id="fbFeedItemComment" type="text/html">
        <table>
          <tr>
            <td>
              <a href="{{userProfleLink}}" target="_new">
                <img style='padding-right:5px;' width='32' 
                  src='https://graph.facebook.com/{{commentFromUserId}}/picture?type=small'/>
              </a>
            </td>
            <td>
              <span class='comment-text'>{{commentText}}</span>
            </td>
          </tr>
        </table>
      </script>
    
	    <div data-role="header" data-theme="b">
		    <h1>Post Details</h1>
		    <a href="#fb-feed-page" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-right jqm-home">Home</a> 
	    </div>

	    <div data-role="content" data-theme="b">	
	      <div id="fb-feed-item-detail"></div>
		    
	      <div data-role="collapsible" data-collapsed="true" id="fb-feed-item-comments" style="display:none;">
	        <h4>Comments</h4>
	        <div id="comments">
	        </div>
          <a href="#" style="display:none;" id="more-comments"><small>All comments<small></a>	      
	      </div>		  
	      	    
        <div data-inline="true" style="text-align:right; float:right;">
          <img src="public/images/spinner-small-black.gif" id="fb-like-spinner" class="hidden">	  
          <!--<a id="unlike-button" href="javascript:void(0);" class="hidden" data-role="button" data-inline="true" data-icon="delete">Unlike</a>-->
          <img src="public/images/ok.png" id="fb-like-ok" class="hidden">
	        <a id="like-button" href="javascript:void(0);" data-role="button" data-inline="true" data-icon="star">Like</a>
        </div>
        <div data-inline="true" style="text-align:left; float:left;">
	        <a href="#fb-feed-page" data-role="button" data-inline="true" data-icon="arrow-l">Back</a>
        </div>
	    </div>
	    
	    <script>
        $('#fb-feed-item-page').live('pagebeforeshow', function(event, ui) {
          if(fbAuth.needAuth() == true)
            $("#auth-url").attr("href", fbAuth.getAuthUrl()).show();
        });
        
        $('#fb-feed-item-page').live('pageshow', function(event, ui) {
          //fbFeedRenderer.renderAssociationWithMe(currentFbFeedItem);      
        });      
	    </script>
    </div>
    <!-- FB Feed Item Screen -->
  
  
  
  
  
  
  
  
    <!-- FB Auth Screen -->
    <div data-role="page" id="fb-auth-page" data-theme="b">
	    <div data-role="header">
		    <h1>Connect with Facebook</h1>
	    </div>

	    <div data-role="content" data-theme="b">	
	      <p style="text-align:center;">
	        <h3><a href="" id="auth-url">FB Connect</a></h3>
	      </p>
	    </div>
	    
	    <script>
        $('#fb-auth-page').live('pagebeforeshow', function(event, ui) {
          if(fbAuth.needAuth() == true)
            $("#auth-url").attr("href", fbAuth.getAuthUrl()).show();
          else
            $.mobile.changePage($("#fb-feed-page"));
        });
	    </script>
    </div>
    <!-- FB Auth Screen -->    
  
  
	  <div style="display:none;">
	    Feed List
		  <ul id="feed-items">
		  </ul>
	  </div>
	  
  </body> 
 
</html> 